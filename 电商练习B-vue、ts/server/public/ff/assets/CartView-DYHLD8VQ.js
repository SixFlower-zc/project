import{c as D,e as ce,q as V,d as H,f as re,s as k,v as F,x as de,y as oe,a,z as me,g as z,w as W,m as y,n as N,A as K,D as M,E as $,H as J,G as Q,I as Z,J as be,K as ge,L as G,M as ee,O as fe,P as he,Q as _e,S as ve,T as te,U as Se,V as xe,W as ie,_ as Ce,X as Ve,h as R,i as ne,F as ae,l as ye,k as C,o as U,p as Pe,j as p,t as le,Y as O,N as pe,C as ke,R as Be}from"./index-Dx_JHYpV.js";import{c as Ie,s as Le}from"./index-DAuTePCu.js";const[Te,Qe]=D("checkbox-group"),we=Symbol(Te),[Ne,Ae]=D("checkbox"),Ee=ce({},Ie,{shape:String,bindGroup:V,indeterminate:{type:Boolean,default:null}});var Fe=H({name:Ne,props:Ee,emits:["change","update:modelValue"],setup(e,{emit:n,slots:l}){const{parent:s}=re(we),d=c=>{const{name:g}=e,{max:x,modelValue:b}=s.props,i=b.slice();if(c)!(x&&i.length>=+x)&&!i.includes(g)&&(i.push(g),e.bindGroup&&s.updateValue(i));else{const f=i.indexOf(g);f!==-1&&(i.splice(f,1),e.bindGroup&&s.updateValue(i))}},m=k(()=>s&&e.bindGroup?s.props.modelValue.indexOf(e.name)!==-1:!!e.modelValue),o=(c=!m.value)=>{s&&e.bindGroup?d(c):n("update:modelValue",c),e.indeterminate!==null&&n("change",c)};return F(()=>e.modelValue,c=>{e.indeterminate===null&&n("change",c)}),de({toggle:o,props:e,checked:m}),oe(()=>e.modelValue),()=>a(Le,z({bem:Ae,role:"checkbox",parent:s,checked:m.value,onToggle:o},e),me(l,["default","icon"]))}});const De=W(Fe),[Me,A]=D("stepper"),$e=200,E=(e,n)=>String(e)===String(n),Ge={min:y(1),max:y(1/0),name:y(""),step:y(1),theme:String,integer:Boolean,disabled:Boolean,showPlus:V,showMinus:V,showInput:V,longPress:V,autoFixed:V,allowEmpty:Boolean,modelValue:N,inputWidth:N,buttonSize:N,placeholder:String,disablePlus:Boolean,disableMinus:Boolean,disableInput:Boolean,beforeChange:Function,defaultValue:y(1),decimalLength:N};var Re=H({name:Me,props:Ge,emits:["plus","blur","minus","focus","change","overlimit","update:modelValue"],setup(e,{emit:n}){const l=(t,r=!0)=>{const{min:h,max:T,allowEmpty:v,decimalLength:w}=e;return v&&t===""||(t=Q(String(t),!e.integer),t=t===""?0:+t,t=Number.isNaN(t)?+h:t,t=r?Math.max(Math.min(+T,t),+h):t,Z(w)&&(t=t.toFixed(+w))),t},s=()=>{var t;const r=(t=e.modelValue)!=null?t:e.defaultValue,h=l(r);return E(h,e.modelValue)||n("update:modelValue",h),h};let d;const m=K(),o=K(s()),c=k(()=>e.disabled||e.disableMinus||+o.value<=+e.min),g=k(()=>e.disabled||e.disablePlus||+o.value>=+e.max),x=k(()=>({width:ee(e.inputWidth),height:ee(e.buttonSize)})),b=k(()=>fe(e.buttonSize)),i=()=>{const t=l(o.value);E(t,o.value)||(o.value=t)},f=t=>{e.beforeChange?he(e.beforeChange,{args:[t],done(){o.value=t}}):o.value=t},u=()=>{if(d==="plus"&&g.value||d==="minus"&&c.value){n("overlimit",d);return}const t=d==="minus"?-e.step:+e.step,r=l(_e(+o.value,t));f(r),n(d)},_=t=>{const r=t.target,{value:h}=r,{decimalLength:T}=e;let v=Q(String(h),!e.integer);if(Z(T)&&v.includes(".")){const j=v.split(".");v=`${j[0]}.${j[1].slice(0,+T)}`}e.beforeChange?r.value=String(o.value):E(h,v)||(r.value=v);const w=v===String(+v);f(w?+v:v)},B=t=>{var r;e.disableInput?(r=m.value)==null||r.blur():n("focus",t)},I=t=>{const r=t.target,h=l(r.value,e.autoFixed);r.value=String(h),o.value=h,be(()=>{n("blur",t),ge()})};let P,L;const q=()=>{L=setTimeout(()=>{u(),q()},$e)},se=()=>{e.longPress&&(P=!1,clearTimeout(L),L=setTimeout(()=>{P=!0,u(),q()},ve))},X=t=>{e.longPress&&(clearTimeout(L),P&&G(t))},ue=t=>{e.disableInput&&G(t)},Y=t=>({onClick:r=>{G(r),d=t,u()},onTouchstartPassive:()=>{d=t,se()},onTouchend:X,onTouchcancel:X});return F(()=>[e.max,e.min,e.integer,e.decimalLength],i),F(()=>e.modelValue,t=>{E(t,o.value)||(o.value=l(t))}),F(o,t=>{n("update:modelValue",t),n("change",t,{name:e.name})}),oe(()=>e.modelValue),()=>a("div",{role:"group",class:A([e.theme])},[M(a("button",z({type:"button",style:b.value,class:[A("minus",{disabled:c.value}),{[J]:!c.value}],"aria-disabled":c.value||void 0},Y("minus")),null),[[$,e.showMinus]]),M(a("input",{ref:m,type:e.integer?"tel":"text",role:"spinbutton",class:A("input"),value:o.value,style:x.value,disabled:e.disabled,readonly:e.disableInput,inputmode:e.integer?"numeric":"decimal",placeholder:e.placeholder,autocomplete:"off","aria-valuemax":e.max,"aria-valuemin":e.min,"aria-valuenow":o.value,onBlur:I,onInput:_,onFocus:B,onMousedown:ue},null),[[$,e.showInput]]),M(a("button",z({type:"button",style:b.value,class:[A("plus",{disabled:g.value}),{[J]:!g.value}],"aria-disabled":g.value||void 0},Y("plus")),null),[[$,e.showPlus]])])}});const Ue=W(Re),[Oe,S,ze]=D("submit-bar"),Ke={tip:String,label:String,price:Number,tipIcon:String,loading:Boolean,currency:te("¥"),disabled:Boolean,textAlign:String,buttonText:String,buttonType:te("danger"),buttonColor:String,suffixLabel:String,placeholder:Boolean,decimalLength:y(2),safeAreaInsetBottom:V};var He=H({name:Oe,props:Ke,emits:["submit"],setup(e,{emit:n,slots:l}){const s=K(),d=Se(s,S),m=()=>{const{price:b,label:i,currency:f,textAlign:u,suffixLabel:_,decimalLength:B}=e;if(typeof b=="number"){const I=(b/100).toFixed(+B).split("."),P=B?`.${I[1]}`:"";return a("div",{class:S("text"),style:{textAlign:u}},[a("span",null,[i||ze("label")]),a("span",{class:S("price")},[f,a("span",{class:S("price-integer")},[I[0]]),P]),_&&a("span",{class:S("suffix-label")},[_])])}},o=()=>{var b;const{tip:i,tipIcon:f}=e;if(l.tip||i)return a("div",{class:S("tip")},[f&&a(xe,{class:S("tip-icon"),name:f},null),i&&a("span",{class:S("tip-text")},[i]),(b=l.tip)==null?void 0:b.call(l)])},c=()=>n("submit"),g=()=>l.button?l.button():a(ie,{round:!0,type:e.buttonType,text:e.buttonText,class:S("button",e.buttonType),color:e.buttonColor,loading:e.loading,disabled:e.disabled,onClick:c},null),x=()=>{var b,i;return a("div",{ref:s,class:[S(),{"van-safe-area-bottom":e.safeAreaInsetBottom}]},[(b=l.top)==null?void 0:b.call(l),o(),a("div",{class:S("bar")},[(i=l.default)==null?void 0:i.call(l),m(),g()])])};return()=>e.placeholder?d(x):x()}});const We=W(He),qe={setup(){return{cartStore:Ve()}},computed:{allPrice(){return this.cartList.filter(e=>e.is_select==!0).reduce((e,n)=>e+n.cart_number*n.current_price*100,0)}},data(){return{cartList:[],isAll:!1,countPrice:0}},methods:{onSubmit(){},async allChange(){console.log(this.isAll)},async singleChange(e){let n=e.goods_id,l=localStorage.getItem("uid"),s=await R({url:"/cart/select",method:"post",data:{id:l,goodsId:n}});console.log(s.data),this.loadList()},async updateNumChange(e){let n=e.goods_id,l=localStorage.getItem("uid"),s=await R({url:"/cart/number",method:"post",data:{id:l,goodsId:n,number:e.cart_number}});console.log(s.data),this.loadList()},async onDelBtnClick(e){let n=e.goods_id,l=localStorage.getItem("uid"),s=await R({url:"/cart/remove",method:"get",params:{id:l,goodsId:n}});console.log(s.data),this.loadList()},async loadList(){this.cartStore.getCartList().then(()=>{this.cartList=this.cartStore.cartList,this.isAll=this.cartList.every(e=>e.is_select==!0),this.countPrice=this.cartList.filter(e=>e.is_select==!0).reduce((e,n)=>e+n.cart_number*n.current_price*100,0)})}},async created(){this.loadList()}},Xe=["src"];function Ye(e,n,l,s,d,m){const o=pe,c=De,g=ke,x=Ue,b=ie,i=Be,f=We;return U(),ne(ae,null,[a(o,{title:"购物车",fixed:"",placeholder:""}),(U(!0),ne(ae,null,ye(d.cartList,u=>(U(),Pe(i,{key:u.goods_id},{default:C(()=>[a(g,{span:"2"},{default:C(()=>[a(c,{modelValue:u.is_select,"onUpdate:modelValue":_=>u.is_select=_,onClick:_=>m.singleChange(u)},null,8,["modelValue","onUpdate:modelValue","onClick"])]),_:2},1024),a(g,{span:"8"},{default:C(()=>[p("img",{src:u.img_small_logo,alt:""},null,8,Xe)]),_:2},1024),a(g,{span:"14"},{default:C(()=>[p("div",null,le(u.title),1),p("div",null,le(u.current_price),1),p("div",null,[O("数量："),a(x,{modelValue:u.cart_number,"onUpdate:modelValue":_=>u.cart_number=_,onChange:_=>m.updateNumChange(u)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),p("div",null,[a(b,{type:"danger",onClick:_=>m.onDelBtnClick(u)},{default:C(()=>[O("删除")]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128)),a(f,{price:m.allPrice,"button-text":"提交订单",onSubmit:m.onSubmit},{default:C(()=>[a(c,{modelValue:d.isAll,"onUpdate:modelValue":n[0]||(n[0]=u=>d.isAll=u),onClick:m.allChange},{default:C(()=>[O("全选")]),_:1},8,["modelValue","onClick"])]),_:1},8,["price","onSubmit"])],64)}const Ze=Ce(qe,[["render",Ye],["__scopeId","data-v-d9bd7366"]]);export{Ze as default};
